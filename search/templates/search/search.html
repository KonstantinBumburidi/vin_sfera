{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags %}

{% block title %}–ü–æ–∏—Å–∫{% endblock %}

{% block meta_description %}–ü–æ–∏—Å–∫ –ø–æ —Å–∞–π—Ç—É –°—Ñ–µ—Ä–∞ –°–æ–∑–Ω–∞–Ω–∏—è ‚Äî –∫–æ—Å–º–æ—ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞, –∫–∏–Ω–µ–∑–∏–æ–ª–æ–≥–∏—è, –±–∏–æ—Ä–µ–∑–æ–Ω–∞–Ω—Å{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center">
        {% if search_query %}
            –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: ¬´{{ search_query }}¬ª
        {% else %}
            –ü–æ–∏—Å–∫ –ø–æ —Å–∞–π—Ç—É
        {% endif %}
    </h1>

    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
    <form action="{% url 'search' %}" method="get" class="mb-10">
        <div class="flex gap-4">
            <div class="relative flex-1">
                <input
                    type="text"
                    name="query"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..."
                    value="{{ search_query|default:'' }}"
                    class="w-full px-5 py-3 pr-12 rounded-xl border-2 border-gray-200 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 outline-none transition-all text-lg"
                    autofocus
                >
                <button type="submit" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-cyan-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </button>
            </div>
            <button
                type="submit"
                class="px-6 py-3 bg-cyan-600 text-white font-medium rounded-xl hover:bg-cyan-700 transition-colors shadow-md hover:shadow-lg"
            >
                –ù–∞–π—Ç–∏
            </button>
        </div>
    </form>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
    {% if search_results %}
        <div class="mb-6 text-gray-600">
            –ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {{ search_results.paginator.count }}
        </div>

        <div class="space-y-6">
            {% for result in search_results %}
                {% with result_type=result.content_type.model %}
                <article class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow overflow-hidden">
                    <a href="{% pageurl result %}" class="block md:flex">
                        <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
                        <div class="md:w-48 h-48 md:h-auto flex-shrink-0 bg-gray-100">
                            {% if result.specific.main_image %}
                                {% image result.specific.main_image fill-300x200 as img %}
                                <img src="{{ img.url }}" alt="{{ result.title }}" class="w-full h-full object-cover">
                            {% elif result_type == 'videopage' %}
                                <div class="w-full h-full flex items-center justify-center bg-cyan-100">
                                    <svg class="w-16 h-16 text-cyan-400" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                </div>
                            {% elif result_type == 'audiopage' %}
                                <div class="w-full h-full flex items-center justify-center bg-purple-100">
                                    <svg class="w-16 h-16 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                                    </svg>
                                </div>
                            {% else %}
                                <div class="w-full h-full flex items-center justify-center bg-gray-200">
                                    <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                </div>
                            {% endif %}
                        </div>

                        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
                        <div class="flex-1 p-5">
                            <!-- –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                            <div class="mb-2">
                                {% if result_type == 'blogpage' %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        üìÑ –°—Ç–∞—Ç—å—è
                                    </span>
                                {% elif result_type == 'videopage' %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-cyan-100 text-cyan-800">
                                        üé¨ –í–∏–¥–µ–æ
                                    </span>
                                {% elif result_type == 'audiopage' %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                                        üéß –ê—É–¥–∏–æ
                                    </span>
                                {% elif result_type == 'channelsectionpage' %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
                                        ‚ö° –ß–∞—Å—Ç–æ—Ç—ã
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                        üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞
                                    </span>
                                {% endif %}
                            </div>

                            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                            <h2 class="text-xl font-semibold text-gray-800 hover:text-cyan-600 transition-colors mb-2">
                                {{ result.title }}
                            </h2>

                            <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                            {% if result.search_description %}
                                <p class="text-gray-600 line-clamp-2">{{ result.search_description }}</p>
                            {% elif result.specific.intro %}
                                <p class="text-gray-600 line-clamp-2">{{ result.specific.intro|truncatewords:30 }}</p>
                            {% endif %}

                            <!-- –î–∞—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
                            {% if result.specific.date %}
                                <p class="text-sm text-gray-400 mt-3">
                                    üìÖ {{ result.specific.date|date:"d M Y" }}
                                </p>
                            {% endif %}
                        </div>
                    </a>
                </article>
                {% endwith %}
            {% endfor %}
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if search_results.has_other_pages %}
        <nav class="mt-10 flex justify-center items-center gap-2">
            {% if search_results.has_previous %}
                <a
                    href="{% url 'search' %}?query={{ search_query|urlencode }}&page={{ search_results.previous_page_number }}"
                    class="px-4 py-2 rounded-lg bg-white border border-gray-200 text-gray-600 hover:bg-gray-50 hover:border-cyan-300 transition-colors"
                >
                    ‚Üê –ù–∞–∑–∞–¥
                </a>
            {% else %}
                <span class="px-4 py-2 rounded-lg bg-gray-100 text-gray-400 cursor-not-allowed">
                    ‚Üê –ù–∞–∑–∞–¥
                </span>
            {% endif %}

            <!-- –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü -->
            <div class="flex gap-1">
                {% for num in search_results.paginator.page_range %}
                    {% if search_results.number == num %}
                        <span class="px-4 py-2 rounded-lg bg-cyan-600 text-white font-medium">
                            {{ num }}
                        </span>
                    {% elif num > search_results.number|add:'-3' and num < search_results.number|add:'3' %}
                        <a
                            href="{% url 'search' %}?query={{ search_query|urlencode }}&page={{ num }}"
                            class="px-4 py-2 rounded-lg bg-white border border-gray-200 text-gray-600 hover:bg-gray-50 hover:border-cyan-300 transition-colors"
                        >
                            {{ num }}
                        </a>
                    {% endif %}
                {% endfor %}
            </div>

            {% if search_results.has_next %}
                <a
                    href="{% url 'search' %}?query={{ search_query|urlencode }}&page={{ search_results.next_page_number }}"
                    class="px-4 py-2 rounded-lg bg-white border border-gray-200 text-gray-600 hover:bg-gray-50 hover:border-cyan-300 transition-colors"
                >
                    –î–∞–ª–µ–µ ‚Üí
                </a>
            {% else %}
                <span class="px-4 py-2 rounded-lg bg-gray-100 text-gray-400 cursor-not-allowed">
                    –î–∞–ª–µ–µ ‚Üí
                </span>
            {% endif %}
        </nav>
        {% endif %}

    {% elif search_query %}
        <!-- –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div class="text-center py-12">
            <div class="text-6xl mb-4">üîç</div>
            <h2 class="text-xl font-semibold text-gray-700 mb-2">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h2>
            <p class="text-gray-500 mb-6">
                –ü–æ –∑–∞–ø—Ä–æ—Å—É ¬´{{ search_query }}¬ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
            </p>
            <p class="text-gray-400 text-sm">
                –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞.
            </p>
        </div>
    {% else %}
        <!-- –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
        <div class="text-center py-12">
            <div class="text-6xl mb-4">üîé</div>
            <p class="text-gray-500">
                –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –≤—ã—à–µ
            </p>
        </div>
    {% endif %}
</div>
{% endblock %}