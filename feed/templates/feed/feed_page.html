{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block content %}
    <div class="max-w-4xl mx-auto">
        <!-- Вступительный текст -->
        {% if page.intro %}
            <div class="prose prose-lg mb-12 text-gray-700">
                {{ page.intro|richtext }}
            </div>
        {% endif %}

        <h1 class="text-3xl font-bold text-cyan-700 mb-8">Внутренние новости</h1>

        <!-- Если не авторизован -->
        {% if not user.is_authenticated %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
                <p class="text-lg text-yellow-800">Войдите, чтобы видеть ленту и создавать посты.</p>
            </div>
        {% else %}
            <!-- Кнопка «Новый пост» (плавающая) -->
            <button
                hx-get="{% url 'feed:post_create' %}"
                hx-target="#modal-body"
                hx-on-htmx-after-request="
                    document.getElementById('post-modal').classList.remove('hidden');
                    document.getElementById('modal-title').textContent = 'Новый пост';
                "
                class="fixed bottom-8 right-8 bg-cyan-700 text-white rounded-full w-16 h-16 shadow-2xl hover:bg-cyan-600 flex items-center justify-center text-4xl z-40">
                +
            </button>

            <!-- Контейнер для списка постов (htmx будет заменять его содержимое) -->
            <div id="posts-container">
                {% include "feed/posts_list.html" %}
            </div>
        {% endif %}

        <!-- Универсальная модалка -->
        <div id="post-modal" class="fixed inset-0 bg-black/60 hidden z-50 flex items-center justify-center px-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto relative">
                <!-- Кнопка закрытия -->
                <button
                    type="button"
                    hx-on-click="this.closest('#post-modal').classList.add('hidden')"
                    class="absolute top-6 right-6 text-3xl text-gray-500 hover:text-gray-700">
                    ×
                </button>

                <!-- Заголовок модалки -->
                <div id="modal-title" class="text-3xl font-bold text-cyan-700 px-10 pt-10 pb-6"></div>

                <!-- Тело модалки (сюда htmx загрузит форму) -->
                <div id="modal-body" class="px-10 pb-10"></div>
            </div>
        </div>
    </div>
{% endblock %}