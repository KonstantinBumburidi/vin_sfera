{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block content %}
    <div class="max-w-4xl mx-auto">
        <!-- –í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
        {% if page.intro %}
            <div class="prose prose-lg mb-12 text-gray-700">
                {{ page.intro|richtext }}
            </div>
        {% endif %}

        <h1 class="text-3xl font-bold text-cyan-700 mb-8">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h1>

        <!-- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω -->
        {% if not user.is_authenticated %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
                <p class="text-lg text-yellow-800">–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–µ–Ω—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.</p>
            </div>
        {% endif %}

        <!-- –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤ -->
        {% if posts %}
            <div class="space-y-8">
                {% for post in posts %}
                    <article class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow">
                        <div class="p-6">
                            <!-- –ê–≤—Ç–æ—Ä –∏ –¥–∞—Ç–∞ -->
                            <div class="flex items-center space-x-4 mb-4">
                                <div class="bg-gray-200 border-2 border-dashed rounded-full w-12 h-12"></div> <!-- –∞–≤–∞—Ç–∞—Ä–∫–∞ –ø–æ—Ç–æ–º -->
                                <div>
                                    <p class="font-semibold text-lg">{{ post.author.get_full_name|default:post.author.username }}</p>
                                    <p class="text-sm text-gray-500">{{ post.created_at|date:"d.m.Y H:i" }}
                                        {% if post.pinned %}<span class="ml-2 text-cyan-600 font-medium">–ó–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–π</span>{% endif %}
                                    </p>
                                </div>
                            </div>

                            <!-- –¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ -->
                            <div class="prose prose-lg mb-6">
                                {{ post.content|linebreaks }}
                            </div>

                            <!-- –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                            {% if post.images.exists %}
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                                    {% for img in post.images.all %}
                                        {% image img.image fill-400x300 as photo %}
                                        <img src="{{ photo.url }}" alt="" class="rounded-lg object-cover w-full h-48">
                                    {% endfor %}
                                </div>
                            {% endif %}

                            <!-- –î–æ–∫—É–º–µ–Ω—Ç—ã -->
                            {% if post.documents.exists %}
                                <div class="mb-6">
                                    <p class="font-medium text-gray-700 mb-2">–ü—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:</p>
                                    <ul class="space-y-2">
                                        {% for doc in post.documents.all %}
                                            <li>
                                                <a href="{{ doc.document.url }}" target="_blank" class="text-cyan-600 hover:underline">
                                                    üìÑ {{ doc.document.title }}
                                                </a>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}

                            <!-- –°—á—ë—Ç—á–∏–∫–∏ (–ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã) -->
                            <div class="flex items-center space-x-6 text-sm text-gray-500">
                                <span>üëÅ {{ post.views_count }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
                                <span>‚ù§Ô∏è {{ post.likes_count }}</span>
                                <span>üí¨ {{ post.comments_count }}</span>
                            </div>
                        </div>
                    </article>
                {% endfor %}
            </div>
        {% else %}
            {% if user.is_authenticated %}
                <p class="text-center text-gray-600 text-lg">–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤ –≤ –ª–µ–Ω—Ç–µ.</p>
            {% endif %}
        {% endif %}
    </div>
{% endblock %}